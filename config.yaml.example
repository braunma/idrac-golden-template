# iDRAC Golden Template Configuration
# =====================================
# Copy this file to config.yaml and fill in your values.
# In GitLab CI/CD, credentials are injected via pipeline variables:
#   IDRAC_USERNAME, IDRAC_PASSWORD

# ==========================================================================
# Server groups
# ==========================================================================
# Define one or more groups. Each group has a source iDRAC to export the
# golden template from, a stable template file path (committed to git and
# editable), and a set of target iDRACs to apply it to.
#
# Workflow per group:
#   1. Export:  python main.py export --group compute-nodes
#              → exports SCP from source_ip, writes to "template" path
#   2. Edit:   manually tweak the template in your repo, commit the changes
#   3. Import: python main.py import --group compute-nodes
#              → applies the template file to every target in that group
#
# You can also run all groups at once by omitting --group.

groups:
  compute-nodes:
    source_ip: "192.168.1.1"
    template: "templates/compute-nodes.xml"
    targets:
      - "192.168.1.1-192.168.1.9"

  storage-nodes:
    source_ip: "192.168.1.17"
    template: "templates/storage-nodes.xml"
    targets:
      - "192.168.1.20-192.168.1.25"

# ==========================================================================
# Legacy single-source format (still supported)
# ==========================================================================
# If you don't need groups, you can use the original flat format instead.
# It behaves as a single implicit group called "default".
#
# source:
#   ip: "192.168.1.100"
#
# targets:
#   - "192.168.1.101"
#   - "192.168.1.102"
#   # - "192.168.1.110-192.168.1.120"

# Export settings
export:
  # Components to export: ALL, BIOS, IDRAC, NIC, RAID, FC, LifecycleController
  target: "ALL"
  # Output format: XML or JSON
  format: "XML"
  # Include options: Default, IncludeReadOnly, IncludePasswordHashValues
  include: "Default"

# Import settings
import:
  # Shutdown type: Graceful, Forced, NoReboot
  shutdown_type: "Graceful"
  # Host power state after import: On, Off
  host_power_state: "On"

# Connection settings
connection:
  # Disable SSL certificate verification (typical for self-signed iDRAC certs)
  verify_ssl: false
  # Request timeout in seconds
  timeout: 30
  # Number of retries on transient failures
  retries: 3
  # Seconds between job status polls
  poll_interval: 15
  # Maximum seconds to wait for a job to complete
  job_timeout: 1800

# ==========================================================================
# Pipeline automation
# ==========================================================================
# Controls what the "run_pipeline" CI job does when triggered.
# Change this section to switch between workflows without touching .gitlab-ci.yml.
#
# Available steps (executed in order):
#   validate  - test Redfish connectivity to all configured iDRACs
#   export    - export SCP from source iDRAC(s) into the configured template file(s)
#   import    - apply the committed template file(s) to all target iDRACs
#   apply     - export + import in one shot (shorthand for both above)
#
# Workflow A — Export now, import later:
#   1. Set steps: [validate, export] and run the pipeline to snapshot configs.
#   2. Review/edit the exported templates in templates/, then commit them to git.
#   3. Change steps to [validate, import] and run the pipeline to apply them.
#
# Workflow B — Full apply in one step:
#   Set steps: [apply] to export a fresh snapshot and immediately apply it.
#
pipeline:
  steps:
    - validate
    - export

  # When true, exported templates are automatically committed and pushed back to
  # the repository after an export step. This lets you snapshot iDRAC configs via
  # the pipeline, review the diff in a merge request, and apply them later by
  # changing steps to [import].
  #
  # Requires a GitLab project access token with write_repository scope stored as
  # the CI_PUSH_TOKEN variable (Settings → CI/CD → Variables, masked + protected).
  commit_exports: false
